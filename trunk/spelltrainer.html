<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="Text/HTML; CharSet=ISO-8859-1">
<meta name="Author" content="Vasily Zakharov (vmzakhar@gmail.com)">
<link rel="Shortcut Icon" href="favicon.ico">
<style type="text/css">
html, body {
	margin: 0;
	padding: 0;
	font-family: Verdana, Arial, Helvetica, sans-serif;
}

p {
	margin: 2ex;
	padding: 0;
}

.welcome {
	color: black;
	background-color: white;
}

.ready {
	color: white;
	background-color: black;
}

.attack {
	color: green;
	background-color: black;
}

.defence {
	color: white;
	background-color: #800000;
}

.flash {
	color: white;
	background-color: white;
}

.important {
	font-weight: bold;
}

.example {
	font-weight: bold;
	padding: 3px;
}

table.visible {
	display: table;
}

td.visible {
	display: table-cell;
}

.invisible {
	display: none;
}

img.logo {
	background-color: white;
	border: 0;
}

#headerBlock, #footerBlock {
	color: black;
	background-color: gray;
	height: 38px;
}

#noscriptBlock, #mainBlock {
	width: 100%;
	height: 100%;
}

#infoBlock, #welcomeBlock {
	text-align: center;
}

#headerTitle {
	color: black;
	font-weight: bold;
}

#noscriptTitle, #welcomeTitle {
	margin: 0;
	padding: 0;
}

#castBlock {
	text-align: center;
	vertical-align: middle;
	font-weight: bold;
}

#startButton {
	font-size: 300%;
	font-weight: bold;
	cursor: pointer;
	margin: 0.2ex 0 0.3ex 0;
	padding: 0.5ex 0.5em;
}

#loggerBlock {
	height: 38px;
	font-size: 50%;
	overflow: auto;
}
</style>
<!--[if IE]>
<style type="text/css">
table.visible, td.visible {
	display: block;
}

#startButton {
	padding: 0;
}
</style>
<![endif]-->
<script type="text/javascript">
var SIMPLA = ['Impedimenta', 'Tarantallegra', 'Silencio',		// Protego
              'Rictusempra', 'Incarcero', 'Mento Menores',		// Defendo
              'Stupefy', 'Achelitus', 'Maledicero',			// Enervate
              'Incendio', 'Deluvium', 'Tormencio', 'Conjunctivitus'];	// VIP

var MAXIMA = [];
for (var i = 0, spell; spell = SIMPLA[i]; i++) {
     MAXIMA.push(spell + ' Maxima');
};
MAXIMA.concat(['Petrificus Totalus', 'Expelliarmus']);

var ULTIMA = [];
for (var i = 0, spell; spell = SIMPLA[i]; i++) {
     ULTIMA.push(spell + ' Ultima');
};

var RULE_OF_N_SPELLS = 3;

var FONT_NAME = 'Verdana';
var FONT_SIZE = 10;
var FONT_STYLE = 'bold';
var MIN_FONT_SIZE = 20;

var spellDelay = 3000;
var flashDelay = 100;

var useSimpla = true;
var useMaxima = true;
var useUltima = false;

var trainAttack = true;
var trainDefence = true;

function debug(message) {
    logger.innerHTML += new Date().toLocaleTimeString() + '&nbsp;&nbsp;' + message + '<br>';
    logger.scrollTop = logger.scrollHeight;
}

function SpellGenerator(spells, nSpells) {
    this.spells = spells;
    this.nSpells = nSpells;
    this.previousSpells = [];
    this.next = function() {
        newSpell:
        while (true) {
            spell = this.spells[Math.floor(Math.random() * this.spells.length)];
            baseIndex = spell.indexOf(' ');
            baseSpell = baseIndex >= 0 ? spell.slice(0, baseIndex) : spell;
            for (var i = 0, previousSpell; previousSpell = this.previousSpells[i]; i++) {
                if (previousSpell === baseSpell) {
                    continue newSpell;
                }
            }
            this.previousSpells = (this.previousSpells.concat([baseSpell])).slice(-(this.nSpells - 1));
            return spell;
        }
    }
}

function castSpell() {
    if (trainAttack && (!trainDefence || Math.random() >= 0.5)) {
        cast.innerHTML = attackSpells.next();
        body.className = 'attack';
        debug('Attack: ' + cast.innerHTML);
    } else {
        cast.innerHTML = defenceSpells.next();
        body.className = 'defence';
        debug('Defence: ' + cast.innerHTML);
    }
    timeout = setTimeout('hideSpell()', spellDelay);
}

function hideSpell() {
    body.className = 'flash';
    timeout = setTimeout('castSpell()', flashDelay);
}

function resize() {
    debug('resize');
    cast.style.fontSize = MIN_FONT_SIZE;
    cast.style.fontSize = Math.floor(Math.min(cast.offsetHeight * 0.7, cast.offsetWidth * aspect)) + 'px';
}

function start() {
    debug('start');
    var spells = (useSimpla ? SIMPLA : []).concat(useMaxima ? MAXIMA : []).concat(useUltima ? ULTIMA : []);
    attackSpells = new SpellGenerator(spells, RULE_OF_N_SPELLS);
    defenceSpells = new SpellGenerator(spells, RULE_OF_N_SPELLS);
    body.className = 'flash';
    cast.innerHTML = '<span id="test"><\/span>';
    var test = document.getElementById('test');
    welcome.className = 'invisible';
    cast.className = 'visible';
    aspect = 1000;
    for (var i = 0; test.innerHTML = spells[i]; i++) {
        aspect = Math.min(aspect, test.offsetHeight / test.offsetWidth);
    }
    aspect *= 0.7;
    cast.innerHTML = 'Get ready!';
    resize();
    body.onresize = onresize = resize;
    body.className = 'ready';
    timeout = setTimeout('castSpell()', spellDelay);
}

function stop() {
    debug('stop');
    clearTimeout(timeout);
    body.className = 'flash';
    cast.className = 'invisible';
    welcome.className = 'visible';
    body.className = 'welcome';
    body.onresize = onresize = null;
}

function main() {
    logger = document.getElementById('loggerBlock');
    debug('main');
    document.getElementById('noscriptBlock').className = 'invisible';
    document.getElementById('mainBlock').className = 'visible';
    body = document.getElementsByTagName('body')[0];
    cast = document.getElementById('castBlock');
    welcome = document.getElementById('welcomeBlock');
    var title = document.getElementById('noscriptTitle').innerHTML;
    document.title = title;
    document.getElementById('headerTitle').innerHTML = title;
    document.getElementById('welcomeTitle').innerHTML = title;
    body.className = 'welcome';
}
</script>
</head>

<body onload="main()">
  <table id="noscriptBlock" class="visible" cellspacing="0" cellpadding="0">
    <tr>
      <td id="infoBlock">
        <h1 id="noscriptTitle">SpellTrainer v0.44</h1>
        <p>[<a href="http://jolaf.jnm.ru/spelltrainer/">Latest version</a>]&nbsp;[<a href="http://code.google.com/p/spelltrainer/">Project page</a>]&nbsp;[<a href="mailto:vmzakhar@gmail.com?Subject=SpellTrainer">Contact mail</a>]</p>
        <p><img class="logo" src="wand.png" alt=""></p>
        <p>This software is created to train players in spellcasting for <a href="http://hp-ekb.ru">Hogwarts Seasons LARPs</a>.</p>
        <br>
        <p class="important">This page requires <a href="http://mozilla.org/js/">JavaScript</a> to operate.</p>
        <p class="important">Please enable JavaScript in your browser and reload the page.</p>
        <br>
        <p>If you experience problems or want to report a bug &ndash; please mail to <a href="mailto:vmzakhar@gmail.com?Subject=SpellTrainer">vmzakhar@gmail.com</a>.</p>
      </td>
    </tr>
  </table>
  <table id="mainBlock" class="invisible" cellspacing="0" cellpadding="0">
    <tr>
      <td id="headerBlock">
        <table cellspacing="0" cellpadding="0">
          <tr>
            <td><a href="http://code.google.com/p/spelltrainer/"><img class="logo" src="wand.png" alt=""></a></td>
            <td id="headerTitle"></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td id="welcomeBlock" class="visible">
        <h1 id="welcomeTitle"></h1>
        <p>[<a href="http://jolaf.jnm.ru/spelltrainer/">Latest version</a>]&nbsp;[<a href="http://code.google.com/p/spelltrainer/">Project page</a>]&nbsp;[<a href="mailto:vmzakhar@gmail.com?Subject=SpellTrainer">Contact mail</a>]</p>
        <p><img class="logo" src="wand.png" alt=""></p>
        <p>This software is created to train players in spellcasting for <a href="http://hp-ekb.ru">Hogwarts Seasons LARPs</a>.</p>
        <p>Adjust the settings at the top bar as neccessary and press</p>
        <p><button id="startButton" type="button" onclick="start()">Start!</button></p>
        <p class="important">Click anywhere in the spell window to stop and return to this screen.</p>
        <p>When you see a spell written in <span class="example attack">attack colors</span> &ndash; cast it at your imaginary opponent.</p>
        <p>When you see a spell written in <span class="example defence">defence colors</span> &ndash; it means that spell is cast by your opponent at you, so cast the respective shield.</p>
        <p>Start with a lower tempo (bigger delay), and then lower the delay as your casting speed improves.</p>
        <p>If you experience problems or want to report a bug &ndash; please mail to <a href="mailto:vmzakhar@gmail.com?Subject=SpellTrainer">vmzakhar@gmail.com</a>.</p>
        <p class="important">Good luck!</p>
      </td>
      <td id="castBlock" class="invisible" onclick="stop()"></td>
    </tr>
    <tr>
      <td id="footerBlock">
        <div id="loggerBlock"></div>
      </td>
    </tr>
  </table>
</body>
</html>

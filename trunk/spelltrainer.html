<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>SpellTrainer v0.1</title>
<meta http-equiv="Content-Type" content="Text/HTML; CharSet=Windows-1251">
<meta name="Author" content="Vasily Zakharov (vmzakhar@gmail.com)">
<link rel="Shortcut Icon" href="favicon.ico">
<style type="text/css">
html, body {
	margin: 0;
	padding: 0;
}

.wide {
	width: 100%;
}

.high {
	height: 100%;
}

.small {
	font-size: 80%;
}

body, p, td, th, div {
	font-family: Verdana, Arial, Helvetica, sans-serif;
}

a {
	font-weight: bold;
}

td#header {
	background-color: gray;
}

h1.title {
	font-size: 100%;
	font-weight: bold;
	margin: 0;
	padding: 0;
}

td#spell {
	text-align: center;
	vertical-align: middle;
	font-weight: bold;
}

div#debug {
	background-color: gray;
	font-size: 50%;
	height: 10ex;
	overflow: auto;
}

.hidden {
	display: none;
}
</style>

<script type="text/javascript">
debugCounter = 1;
function debug(message) {
    // ToDo: print current date/time instead of counter
    element = document.getElementById('debug');
    element.innerHTML = debugCounter++ + ': ' + message + '<br>' + element.innerHTML;
};

var SPELLS = ['Impedimenta', 'Tarantallegra', 'Silencio',		// Protego
              'Rictusempra', 'Incarcero', 'Mento Menores',		// Defendo
              'Stupefy', 'Achelitus', 'Maledicero',			// Enervate
              'Incendio', 'Deluvium', 'Tormencio', 'Conjunctivitus'];	// VIP

var SIMPLA = SPELLS.concat(['Expelliarmus']);

var MAXIMA = [];
for (var i = 0, spell; spell = SPELLS[i]; i++) {
     MAXIMA.push(spell + ' Maxima');
};
MAXIMA.push('Petrificus Totalus');

var ULTIMA = [];
for (var i = 0, spell; spell = SPELLS[i]; i++) {
     ULTIMA.push(spell + ' Ultima');
};

var RULE_OF_N_SPELLS = 3;

var MODE_ATTACK = 0;
var MODE_DEFENCE = 1;

var FONT_NAME = 'Verdana';
var FONT_SIZE = 10;
var FONT_STYLE = 'bold';

var ATTACK_FOREGROUND  = 'green';
var ATTACK_BACKGROUND  = 'black';
var DEFENCE_FOREGROUND = 'white';
var DEFENCE_BACKGROUND = 'red';
var FLASH_FOREGROUND = 'white';
var FLASH_BACKGROUND = 'white';

var spellDelay = 3000;
var flashDelay = 100;

var useSimpla = true;
var useMaxima = true;
var useUltima = true;

var trainAttack = true;
var trainDefence = false;

var spells;

function updateSpellList() {
    spells = (useSimpla ? SIMPLA : []).concat(useMaxima ? MAXIMA : []).concat(useUltima ? ULTIMA : []);
}

function SpellGenerator(spells, nSpells) {
    this.spells = spells;
    this.nSpells = nSpells;
    this.previousSpells = [];
    this.next = function() {
        newSpell:
        while (true) {
            spell = this.spells[Math.floor(Math.random() * this.spells.length)];
            baseSpell = spell.slice(0, spell.indexOf(' '));
            for (var previousSpell in this.previousSpells) {
                if (previousSpell === baseSpell) {
                    continue newSpell;
                }
            }
            this.previousSpells = (this.previousSpells + [baseSpell]).slice(-(this.nSpells - 1));
            return spell;
        }
    }
}

updateSpellList();
var  attackSpells = new SpellGenerator(spells, RULE_OF_N_SPELLS);
var defenceSpells = new SpellGenerator(spells, RULE_OF_N_SPELLS);

function spellOff() {
    debug('spellOff');
    label = document.getElementById('spell');
    label.style.color = FLASH_FOREGROUND;
    label.style.backgroundColor = FLASH_BACKGROUND;
    timeout = setTimeout('spellOn()', flashDelay);
}

function spellOn() {
    debug('spellOn');
    label = document.getElementById('spell');
    if (trainAttack && (!trainDefence || Math.random() >= 0.5)) {
        label.innerHTML = attackSpells.next();
        label.style.color = ATTACK_FOREGROUND;
        label.style.backgroundColor = ATTACK_BACKGROUND;
        debug('Attack: ' + label.innerHTML);
    } else {
        label.innerHTML = attackSpells.next();
        label.style.color = DEFENCE_FOREGROUND;
        label.style.backgroundColor = DEFENCE_BACKGROUND;
        debug('Defence: ' + label.innerHTML);
    }
    timeout = setTimeout('spellOff()', spellDelay);
}
</script>
</head>

<body onload="spellOff()">
  <table class="wide high" cellspacing="0" cellpadding="0">
    <tr>
      <td id="header">
        <table class="wide" cellspacing="0" cellpadding="0">
          <tr>
            <td class="small">
              <h1 class="title">SpellTrainer v0.1</h1>
              <p class="small">[<a href="http://code.google.com/p/spelltrainer/">Project</a>]&nbsp;[<a href="http://spelltrainer.googlecode.com/svn/trunk/spelltrainer.html">HTML</a>]&nbsp;[<a href="http://spelltrainer.googlecode.com/svn/trunk/SpellTrainer.py">Python</a>]</p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr class="high">
      <td id="spell">SpellTrainer v0.1</td>
    </tr>
    <tr>
      <td><div id="debug"></div></td>
    </tr>
  </table>
  <table class="hidden"><tr><td>SpellTrainer v0.1</td></tr></table>
</body>
</html>
